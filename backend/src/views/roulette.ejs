<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Exclusive Roulette</title>

  <style>
    body { background:#0d0d14; color:white; font-family:Arial; text-align:center; padding-top:40px; }
    h1 { font-size:2.2rem; margin-bottom:20px; color:#bb86fc; }

    .back-btn {
      position:absolute; top:20px; left:20px;
      background:#444; padding:10px 18px; border-radius:6px;
      color:white; text-decoration:none; border:1px solid #666;
    }

    #canvasContainer {
      margin:auto;
      width:500px;
      height:500px;
      position:relative;
    }

    /* Flecha de la parte superior */
    .pointer {
      position:absolute;
      top:10px;
      left:50%;
      transform:translateX(-50%);
      width:0;
      height:0;
      border-left:20px solid transparent;
      border-right:20px solid transparent;
      border-bottom:30px solid yellow;
      z-index:10;
    }

    .btn { padding:10px 20px; font-size:1.1rem; margin:10px; border:none; border-radius:6px; cursor:pointer; color:white; }
    .red { background:#e53935; }
    .black { background:#333; }
    .green { background:#2ecc71; }

    #resultText {
      font-size:1.4rem;
      margin-top:20px;
    }
  </style>
</head>

<body>

<a class="back-btn" href="/gamble">‚¨Ö Back to Gambling</a>

<h1>Exclusive Roulette üé∞</h1>

<div id="canvasContainer">
    <div class="pointer"></div>
    <canvas id="rouletteCanvas" width="500" height="500"></canvas>
</div>

<div class="amount-box">
  <label>Amount (‚Ç¨):</label>
  <input id="amount" type="number" min="1" value="5">
</div>

<div>
  <button class="btn red" onclick="spinRoulette('red')">Bet Red</button>
  <button class="btn black" onclick="spinRoulette('black')">Bet Black</button>
  <button class="btn green" onclick="spinRoulette('green')">Bet Green</button>
</div>

<h2 id="resultText"></h2>

<!-- GSAP + Winwheel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/zarocknz/javascript-winwheel/Winwheel.min.js"></script>

<script>
/* ============================================================
   üé® DEFINIR 12 SEGMENTOS IGUALES A TU BACKEND
   ============================================================ */
const segmentData = [
  { num:1,  fill:"red" },
  { num:2,  fill:"black" },
  { num:0,  fill:"green" },
  { num:3,  fill:"red" },
  { num:4,  fill:"black" },
  { num:5,  fill:"green" },
  { num:6,  fill:"red" },
  { num:7,  fill:"black" },
  { num:8,  fill:"green" },
  { num:9,  fill:"red" },
  { num:10, fill:"black" },
  { num:11, fill:"green" },
];

/* ============================================================
   üé° CREAR RULETA REAL CON WINWHEEL.JS
   ============================================================ */
let theWheel = new Winwheel({
    'canvasId'   : 'rouletteCanvas',
    'numSegments': 12,
    'outerRadius': 230,
    'textFontSize': 18,
    'segments'   : segmentData.map(s => ({
        'fillStyle': s.fill,
        'text'     : s.num.toString()
    })),
    'animation' : {
        'type'     : 'spinToStop',
        'duration' : 4,
        'spins'    : 8
    }
});

/* ============================================================
   üéØ FUNCI√ìN PARA GIRAR SINCRONIZADO CON BACKEND
   ============================================================ */
async function spinRoulette(selection) {

    const amount = Number(document.getElementById("amount").value);
    if (!amount || amount <= 0) return alert("Enter valid amount");

    // 1.Pedir resultado REAL del servidor
    const res = await fetch("/exclusive/roulette/play", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount, selection })
    });

    const data = await res.json();
    if (!data.success) return alert(data.error);

    const backendNumber = data.number;
    const backendColor  = data.color;

    // 2Ô∏è.Encontrar segmento que coincide con el n√∫mero
    const index = segmentData.findIndex(s => s.num === backendNumber);
    if (index === -1) return console.error("Valor inv√°lido devolver backend:", backendNumber);

    // 3Ô∏è.Calcular √°ngulo exacto para que Winwheel pare ah√≠
    const stopAngle = (360 / 12) * index + (360 / 24);

    theWheel.stopAnimation(false);         // por si estaba girando
    theWheel.rotationAngle = 0;            // reiniciar
    theWheel.animation.stopAngle = stopAngle;

    // 4Ô∏è.Girar
    theWheel.startAnimation();

    // 5Ô∏è.Mostrar resultado tras animaci√≥n
    setTimeout(() => {
        document.getElementById("resultText").innerHTML = `
            Number: <b>${backendNumber}</b> (${backendColor})<br>
            ${data.win ? "üéâ You WON! +‚Ç¨" + data.payout : "‚ùå You lost"}
        `;
    }, 4200);
}
</script>

</body>
</html>
